angular.module("ui.multiselect",[]).factory("optionParser",["$parse",function(e){var n=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(r){var t=r.match(n);if(!t)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+r+'".');return{itemName:t[3],source:e(t[4]),viewMapper:e(t[2]||t[1]),modelMapper:e(t[1])}}}}]).directive("multiselect",["$parse","$document","$compile","$interpolate","optionParser",function(e,n,r,t,l){return{restrict:"E",require:"ngModel",link:function(n,a,i,u){function c(){V.items.length=0;var e=$.source(n);if(angular.isDefined(e))for(var r=0;r<e.length;r++){var t={};t[$.itemName]=e[r],V.items.push({label:$.viewMapper(t),model:$.modelMapper(t),checked:!1})}}function o(){if(s(u.$modelValue))return V.header=i.msHeader||"Select";if(v)if(i.msSelected)V.header=t(i.msSelected)(V);else if(1==u.$modelValue.length)for(var e=0;e<V.items.length;e++)V.items[e].model===u.$modelValue[0]&&(V.header=V.items[e].label);else V.header=u.$modelValue.length+" selected";else if(angular.isString(u.$modelValue))V.header=u.$modelValue;else{var n={};n[$.itemName]=u.$modelValue,V.header=$.viewMapper(n)||V.items[u.$modelValue].label}}function s(e){if(angular.isNumber(e))return!1;if(e&&e.length&&e.length>0)return!1;for(var n in e)if(e[n])return!1;return!0}function d(e){e.checked?V.uncheckAll():(V.uncheckAll(),e.checked=!e.checked),m(!1)}function f(e){e.checked=!e.checked,m(!0)}function m(e){var n=null;e?(n=[],angular.forEach(V.items,function(e){e.checked&&n.push(e.model)})):angular.forEach(V.items,function(e){return e.checked?(n=e.model,!1):void 0}),u.$setViewValue(n)}function p(e){angular.isArray(e)?angular.forEach(V.items,function(n){n.checked=!1,angular.forEach(e,function(e){angular.equals(n.model,e)&&(n.checked=!0)})}):angular.forEach(V.items,function(n){return angular.equals(n.model,e)?(V.uncheckAll(),n.checked=!0,m(!1),!1):void 0})}var h=u.$isEmpty;u.$isEmpty=function(e){return h(e)||angular.isArray(e)&&0==e.length};var g=i.options,$=l.parse(g),v=i.multiple?!0:!1,k=!1,V=n.$new(),b=i.change||angular.noop;V.items=[],V.header="Select",V.multiple=v,V.disabled=!1,V.onBlur=i.ngBlur||angular.noop,n.$on("$destroy",function(){V.$destroy()});var w=angular.element("<multiselect-popup"+(i.templateUrl?' template-url="'+i.templateUrl+'"':"")+"></multiselect-popup>");(i.required||i.ngRequired)&&(k=!0),i.$observe("required",function(e){k=e}),V.$watch(function(){return e(i.disabled)(n)},function(e){V.disabled=e}),V.$watch(function(){return e(i.multiple)(n)},function(e){v=e||!1}),V.$watch(function(){return $.source(n)},function(e){angular.isDefined(e)&&c()},!0),V.$watch(function(){return u.$modelValue},function(e){angular.isDefined(e)&&(p(e),V.$eval(b)),o(),u.$setValidity("required",V.valid())},!0),c(),a.append(r(w)(V)),V.valid=function(){if(!k)return!0;var e=u.$modelValue;return angular.isArray(e)&&e.length>0||!angular.isArray(e)&&null!=e},V.checkAll=function(){v&&(angular.forEach(V.items,function(e){e.checked=!0}),m(!0))},V.uncheckAll=function(){angular.forEach(V.items,function(e){e.checked=!1}),m(!0)},V.select=function(e){v===!1?(d(e),V.toggleSelect()):f(e)}}}}]).directive("multiselectPopup",["$document",function(e){return{restrict:"E",scope:!1,replace:!0,templateUrl:function(e,n){return n.templateUrl||"multiselect.tmpl.html"},link:function(n,r){function t(a){l(a.target,r.find(a.target.tagName))?n.$parent.$eval(n.onBlur):(r.removeClass("open"),e.unbind("click",t),n.$apply())}n.isVisible=!1,n.toggleSelect=function(){r.hasClass("open")?(r.removeClass("open"),e.unbind("click",t),n.$parent.$eval(n.onBlur)):(r.addClass("open"),e.bind("click",t),n.focus())},n.focus=function(){var e=r.find("input")[0];e&&e.focus()};var l=function(e,n){for(var r=0;r<n.length;r++)if(e==n[r])return!0;return!1}}}}]);